<?xml version="1.0" encoding="UTF-8"?>
<grid>
	<config title="补单一览表" base="/main/sd/pr/" xtype="uxgrid" curd="RE" />
	<search>
		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="textfield" fieldLabel="处理人" name="createuser"/>
				<column xtype="datefield" fieldLabel="创建日期" name="createTime"
					format="Y-m-d" />
				<column xtype="datefield" fieldLabel="到" name="createTime"
					format="Y-m-d" />
			</column>
		</column>
		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="textfield" fieldLabel="订单编号" name="orderCode"/>
				<column xtype="textfield" fieldLabel="店面名称" name="name1"/>
				<!-- <column xtype="datefield" fieldLabel="投诉日期" name="createTime" format="Y-m-d"/>-->
				<column xtype="dictcombobox" fieldLabel="订单类型" name="orderType" dict="ORDER_TYPE_BD"/> 
				<column xtype="textfield" fieldLabel="参考原订单" name="P_ORDER_CODE"/> 
			</column>
		</column>
 		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="dictcombobox" fieldLabel="出错中心" name="zzezxs" dict="CCZX"/>
				<column xtype="textfield" fieldLabel="出错部门" name="zzebms"/>
				<column xtype="textfield" fieldLabel="出错组" name="zzccz"/>
		<!-- 		<column xtype="textfield" fieldLabel="处理人" name="createuser"/> -->
			</column>
		</column> 
<!-- 		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="textfield" fieldLabel="店面名称" name="name1"/>
			</column>
		</column> -->
	</search>
	<head>
		<column xtype="rownumberer" width="30" align="right" />
		<column dataIndex="createTime" xtype="datecolumn" width="150" align="center" text="投诉日期" format="Y-m-d"/>
		<column dataIndex="id" xtype="datecolumn" width="150" align="center" hidden="true"/>
		<column dataIndex="saleId" xtype="datecolumn" width="150" align="center" hidden="true"/>
		<column dataIndex="createTime" xtype="datecolumn" width="150" align="center" text="处理日期" format="Y-m-d"/>
		<column dataIndex="createuser" width="100" align="left" text="处理人"/>
		<column dataIndex="ordertype" width="200" align="left" text="订单类型" />
		<column dataIndex="orderCode" align="left" width="150" text="订单编号" />
		<column dataIndex="name1" width="100" align="left" text="店面名称"/>
		<column dataIndex="pOrderCode" width="150" align="left" text="参考原订单号"/>
		<column dataIndex="yordeType" width="150" align="left" text="参考原订单类型"/>
		<column dataIndex="salefor" width="120" align="left" text="销售分类" />
		<column dataIndex="isYp" width="200" align="left" text="是否样品" />
		<column dataIndex="problem" width="200" align="left" text="问题情况" />
		<column dataIndex="yccreateTime" xtype="datecolumn" width="150" align="center" text="原单下单日期" format="Y-m-d"/>
		<column dataIndex="ycreateTime" xtype="datecolumn" width="150" align="center" text="原单发货日期" format="Y-m-d"/>
		<column dataIndex="orderCodePosex" align="left" width="150" text="原单行号" />
		<column dataIndex="series" align="left" width="150" text="主题系列" />
		<column dataIndex="cabinetName" width="120" align="left" text="柜名" />
		<column dataIndex="color" width="120" align="left" text="颜色" />
		<column dataIndex="cpmc" width="120" align="left" text="产品名称"/>
		<column dataIndex="zzelb" width="120" align="left" text="出错问题"/>
		<column dataIndex="zzcclx" width="120" align="left" text="问题类型"/>
		<column dataIndex="zztsnr" width="200" align="left" text="投诉内容" />
		<column dataIndex="tousucishu" width="200" align="left" text="投诉次数" />
		<column dataIndex="handleTime" width="200" align="left" text="处理时效" />
		<column dataIndex="isQc" width="200" align="left" text="质检检查" />
		<column dataIndex="zzezx" width="120" align="left" text="出错中心" />
		<column dataIndex="zzebm" width="120" align="left" text="出错部门" />
		<column dataIndex="zzccz" width="120" align="left" text="出错组" />
		<column dataIndex="duty" width="120" align="left" text="责任人" />
		<column dataIndex="orderType" width="200" align="left" hidden="true"  text="订单类型" />
		<column dataIndex="zzezxs" width="120" align="left" hidden="true" text="出错中心" />
		<column dataIndex="zzebms" width="120" align="left"  hidden="true" text="出错部门" />
		<!-- <column dataIndex="sapOrderCode" align="left" width="100" text="SAP订单编号" />  
		<column dataIndex="zzccwt" width="120" align="left" text="出错问题" />
		<column dataIndex="jdName" width="120" align="left" text="环节" /> -->
		<column dataIndex="orderStatus" width="120" align="left" text="是否取消" />
	</head>
	<sql vname="RP_EXT_ORD_NEW">
	<![CDATA[
		select distinct (select sh.create_time
          from sale_header sh
         where sh.order_code = t.p_order_code) as yccreate_time,
       (select sh.shi_ji_date
          from sale_header sh
         where sh.order_code = t.p_order_code) as ycreate_time,
         (select (select desc_zh_cn
          from sys_data_dict
         where trie_id = 'EP1Cy8N928muuLvLWP7PxM'
           and key_val = sh.order_type)
          from sale_header sh
         where sh.order_code = t.p_order_code) as yorde_type,
       (select nvl((select sd.desc_zh_cn from sys_data_dict sd where sd.trie_id='Dv81TqVx7qC4AaGJfCCAQp' and sd.key_val=m.matkl),(select sd.desc_zh_cn from sys_data_dict sd where sd.trie_id='32G8cVNfXrmKYiPkwqY9rG' and sd.key_val=m.matkl))
          from material_head m
          left join sale_item si
            on si.material_head_id = m.id
         where si.order_code_posex =
               t.p_order_code ||lpad(t.order_code_posex,'4','0')) as "CABINET_NAME",
       (select (select sd.desc_zh_cn
                  from sys_data_dict sd
                 where sd.trie_id = 'H4XQQRtyEaQp5wMAVWQYB1'
                   and sd.key_val = m.color)
          from material_head m
          left join sale_item si
            on si.material_head_id = m.id
         where si.order_code_posex =
               t.p_order_code || lpad(t.order_code_posex,'4','0')) as "COLOR",
       (select (select sd.desc_zh_cn from sys_data_dict sd where sd.trie_id='CeWcFAdLPH1T5nTbyTbmkp' and sd.key_val=m.sale_for)
          from material_head m
          left join sale_item si
            on si.material_head_id = m.id
         where si.order_code_posex =
               t.p_order_code ||lpad(t.order_code_posex,'4','0')) as "SALEFOR",
        (select (select sd.desc_zh_cn from sys_data_dict sd where sd.trie_id='ATBSFYJp8ScLr3dAxr9CCK' and sd.key_val=m.series)
          from material_head m
          left join sale_item si
            on si.material_head_id = m.id
         where si.order_code_posex =
               t.p_order_code ||lpad(t.order_code_posex,'4','0')) as "SERIES",
       --mh.id,
       t."ORDER_CODE",
       t."CREATE_TIME",
       t."SALE_ID",
       t."ID",
       t."ORDER_TYPE",
       t."P_ORDER_CODE",
       --t."ORDER_STATUS",
       decode(t.order_status,'QX','QX') AS ORDER_STATUS ,
       t."START_TIME",
       t."ORDERTYPE",
       t."TOUSUCISHU",
       --t."CABINET_NAME",
       t."NAME1",
       t."IS_YP",
       decode(t."HANDLE_TIME",'1','一般','加急') as HANDLE_TIME,
       decode(t."IS_QC",'1','是','否') as IS_QC，
       t."PROBLEM",
       t."ORDER_CODE_POSEX",
       t."ZZTSNR",
       t."CPMC",
       --t."COLOR",
       t."JD_NAME",
       --t."SALEFOR",
       t."ZZEZXS",
       t."ZZEBMS",
       t."ZZCCLX",
       t."ZZEZX",
       t."ZZEBM",
       t."ZZCCZ",
       t."ZZELB",
       t."DUTY",
       t."CREATEUSER"
  from ext_ord_report_view_new t
  left join sale_item si
    on si.pid = t.sale_id
  left join material_head mh
    on si.material_head_id = mh.id
 where 1 = 1
   and order_code is not null
		
	]]>
	</sql>
</grid>