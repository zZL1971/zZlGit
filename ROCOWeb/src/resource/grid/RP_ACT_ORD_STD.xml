<?xml version="1.0" encoding="UTF-8"?>
<grid>
	<config title="订单进度报表" base="/main/sd/pr/" xtype="uxgrid" curd="RE"/>
	<search>
		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="datefield" fieldLabel="订单开始日期" name="orderStartTime" format="Y-m-d"/>
				<column xtype="datefield" fieldLabel="到:" name="orderStartTime" format="Y-m-d" />
				<column xtype="datefield" fieldLabel="订单结束日期" name="orderEndTime" format="Y-m-d"/>
				<column xtype="datefield" fieldLabel="到:" name="orderEndTime" format="Y-m-d" />
			</column>
		</column>
	</search>
	<head>
		<column xtype="rownumberer" width="30" align="right"/>
		<column dataIndex="orderCode" width="120" align="left" text="订单号"/>
		<column dataIndex="orderStartTime" width="100" align="center" text="订单日期" xtype="datecolumn" format="Y-m-d"/>
		<column dataIndex="orderStartTime" xtype="datecolumn" width="150" align="center" text="订单开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="orderEndTime" xtype="datecolumn" width="150" align="center" text="订单结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="orderTime" width="90" align="right" text="订单周期(h)"/>		
		<column dataIndex="jiaoQiTianShu" width="80" align="center" text="交期天数"/>
		
		<column dataIndex="usertaskStoreStartTime" xtype="datecolumn" width="150" align="center" text="起草开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskStoreEndTime" xtype="datecolumn" width="150" align="center" text="起草结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskStoreTime" width="90" align="right" text="起草周期(m)"/>
		<column dataIndex="storeStartAgn" width="130" align="center" text="起草起始操作人"/>
		<column dataIndex="storeEndAgn" width="130" align="center" text="起草结束操作人"/>
		
		<column dataIndex="usertaskDrawingStartTime" xtype="datecolumn" width="150" align="center" text="订单审绘开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskDrawingEndTime" xtype="datecolumn" width="150" align="center" text="订单审绘结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskDrawingTime" width="110" align="right" text="订单审绘周期(m)"/>
		<column dataIndex="drawStartAgn" width="130" align="center" text="订单审绘起始操作人"/>
		<column dataIndex="drawEndAgn" width="130" align="center" text="订单审绘结束操作人"/>
		
		<column dataIndex="actSubStartTime" xtype="datecolumn" width="150" align="center" text="子流程开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="actSubEndTime" xtype="datecolumn" width="150" align="center" text="子流程结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="subActTime" width="90" align="right" text="子流程周期(m)"/>
		
		<column dataIndex="usertaskValuationStartTime" xtype="datecolumn" width="150" align="center" text="价格审核开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskValuationEndTime" xtype="datecolumn" width="150" align="center" text="价格审核结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskValuationTime" width="110" align="right" text="价格审核周期(m)"/>
		<column dataIndex="valuationStartAgn" width="130" align="center" text="价格审核起始操作人"/>
		<column dataIndex="valuationEndAgn" width="130" align="center" text="价格审核结束操作人"/>
		
		<column dataIndex="usertaskConfirmStartTime" xtype="datecolumn" width="150" align="center" text="确认报价开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskConfirmEndTime" xtype="datecolumn" width="150" align="center" text="确认报价结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskConfirmTime" width="110" align="right" text="确认报价周期(m)"/>
		<column dataIndex="confirmStartAgn" width="130" align="center" text="确认报价起始操作人"/>
		<column dataIndex="confirmEndAgn" width="130" align="center" text="确认报价结束操作人"/>
		
		<column dataIndex="usertaskFinanceStartTime" xtype="datecolumn" width="150" align="center" text="财务确认开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskFinanceEndTime" xtype="datecolumn" width="150" align="center" text="财务确认结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskFinanceTime" width="110" align="right" text="财务确认周期(m)"/>
		<column dataIndex="financeStartAgn" width="130" align="center" text="财务确认起始操作人"/>
		<column dataIndex="financeEndAgn" width="130" align="center" text="财务确认结束操作人"/>
		
		<column dataIndex="endEvent1StartTime" xtype="datecolumn" width="150" align="center" text="结束流程开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="endEvent1EndTime" xtype="datecolumn" width="150" align="center" text="结束流程结束时间" format="Y-m-d H:i:s"/>
	</head>
	<sql vname="RP_ACT_ORD_STD">
	<![CDATA[ 
	SELECT T.*,
       ROUND((to_date(to_char(order_end_time, 'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss') -
             to_date(to_char(order_start_time, 'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss')),2) * 24 as order_time,
       FLOOR((to_date(to_char(usertask_store_end_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss') -
             to_date(to_char(usertask_store_start_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss')) * 24 * 60) as usertask_store_time,
       FLOOR((to_date(to_char(USERTASK_DRAWING_END_TIME,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss') -
             to_date(to_char(USERTASK_DRAWING_START_TIME,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss')) * 24 * 60) as usertask_drawing_time,
       FLOOR((to_date(to_char(usertask_valuation_start_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss') -
             to_date(to_char(USERTASK_DRAWING_END_TIME,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss')) * 24 * 60) as sub_act_time,
       FLOOR((to_date(to_char(usertask_valuation_end_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss') -
             to_date(to_char(usertask_valuation_start_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss')) * 24 * 60) as usertask_valuation_time,
       FLOOR((to_date(to_char(usertask_confirm_end_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss') -
             to_date(to_char(usertask_confirm_start_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss')) * 24 * 60) as usertask_confirm_time,
       FLOOR((to_date(to_char(usertask_finance_end_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss') -
             to_date(to_char(usertask_finance_start_time,
                              'yyyy-mm-dd hh24:mi:ss'),
                      'yyyy-mm-dd hh24:mi:ss')) * 24 * 60) as usertask_finance_time
  FROM (SELECT tn.order_code,
               MAX(decode(tn.act_id, 'startevent1', tn.start_time)) AS order_start_time,
               MAX(decode(tn.act_id, 'endevent1', tn.end_time)) AS order_end_time,
               MAX(decode(tn.act_id, 'usertask_store', tn.start_time)) AS usertask_store_start_time,
               MAX(decode(tn.act_id, 'usertask_store', tn.end_time)) AS usertask_store_end_time,
               MAX(decode(tn.act_id, 'usertask_store', tn.start_assignee)) AS store_start_agn,
               MAX(decode(tn.act_id, 'usertask_store', tn.end_assignee)) AS store_end_agn,
               MAX(decode(tn.act_id, 'usertask_drawing', tn.start_time)) AS usertask_drawing_start_time,
               MAX(decode(tn.act_id, 'usertask_drawing', tn.end_time)) AS usertask_drawing_end_time,
               MAX(decode(tn.act_id, 'usertask_drawing', tn.start_assignee)) AS draw_start_agn,
               MAX(decode(tn.act_id, 'usertask_drawing', tn.end_assignee)) AS draw_end_agn,
               MAX(decode(tn.act_id, 'usertask_drawing', tn.end_time)) AS act_sub_start_time,
               MAX(decode(tn.act_id, 'usertask_valuation', tn.start_time)) AS act_sub_end_time,
               MAX(decode(tn.act_id, 'usertask_valuation', tn.start_time)) AS usertask_valuation_start_time,
               MAX(decode(tn.act_id, 'usertask_valuation', tn.end_time)) AS usertask_valuation_end_time,
               MAX(decode(tn.act_id, 'usertask_valuation', tn.start_assignee)) AS valuation_start_agn,
               MAX(decode(tn.act_id, 'usertask_valuation', tn.end_assignee)) AS valuation_end_agn,
               MAX(decode(tn.act_id, 'usertask_store_confirm', tn.start_time)) AS usertask_confirm_start_time,
               MAX(decode(tn.act_id, 'usertask_store_confirm', tn.end_time)) AS usertask_confirm_end_time,
               MAX(decode(tn.act_id,
                          'usertask_store_confirm',
                          tn.start_assignee)) AS confirm_start_agn,
               MAX(decode(tn.act_id,
                          'usertask_store_confirm',
                          tn.end_assignee)) AS confirm_end_agn,
               MAX(decode(tn.act_id, 'usertask_finance', tn.start_time)) AS usertask_finance_start_time,
               MAX(decode(tn.act_id, 'usertask_finance', tn.end_time)) AS usertask_finance_end_time,
               MAX(decode(tn.act_id, 'usertask_finance', tn.start_assignee)) AS finance_start_agn,
               MAX(decode(tn.act_id, 'usertask_finance', tn.end_assignee)) AS finance_end_agn,
               MAX(decode(tn.act_id, 'usertask_finance', tn.end_time)) AS end_event1_start_time,
               MAX(decode(tn.act_id, 'usertask_finance', tn.end_time)) AS end_event1_end_time,
               MAX(TN.JIAO_QI_TIAN_SHU) AS JIAO_QI_TIAN_SHU
          FROM ORD_RP_VIEW_STD tn
         GROUP BY tN.order_code) T 
]]>
	</sql>
</grid>