<?xml version="1.0" encoding="UTF-8"?>
<grid>
	<config title="财务确认" taskType="gp_finance" receiveMode="A" eidtRowForm="SMSWeb.view.sale.NewSaleWindow" editRowDataCell="orderType" controllers="sale.SaleController,mm.MyGoodsController,mm.MaterialBaseController"/>
	<search>
		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="hiddenfield" fieldLabel="当前用户" name="ICMQassignee" value="CURR_USER_LOGIN_NO"/>
				<column xtype="textfield" fieldLabel="订单编号" name="orderCode"/>
				<column xtype="dictcombobox" fieldLabel="订单类型" name="orderType" dict="ORDER_TYPE" editable="false"/>
				<column xtype="dictcombobox" fieldLabel="地区" name="regio" dict="REGIO" editable="false"/>
				<column xtype="textfield" fieldLabel="客户名称" name="name1"/>
			</column>
		</column>
		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="datefield" fieldLabel="订单日期[S]" name="orderDate" format="Y-m-d"/>
				<column xtype="datefield" fieldLabel="订单日期[E]" name="orderDate" format="Y-m-d"/>
				<column xtype="dictcombobox" fieldLabel="处理时效" name="handleTime" dict="HANDLE_TIME" editable="false"/>
			</column>
		</column>
	</search>
	<head> 
		<column xtype="rownumberer" width="40" align="right"/>
		<column xtype="actioncolumn" width="40"  align="center" text="编辑" >
			<item icon="/resources/images/remarks1.png" align="center" tooltip="编辑" width="50"  handler="itemEditButtonClick"/>
			<!--<item icon="/resources/images/search.png" align="center" tooltip="快速审批" width="50"  handler="itemShowPicButtonClick"/>
			<item icon="/resources/images/remarks1.png" align="center" tooltip="审批" width="50"  handler="editTaskButtonClick"/>-->
		</column>	
		<column xtype="actioncolumn" width="40" align="center" text="审批" >
			<item icon="/resources/images/search.png" align="center" tooltip="快速审批" width="50"  handler="itemShowPicButtonClick"/>
		</column>	
		<column dataIndex="orderCode" width="150" align="center" text="订单编号" >
		</column>
		<column dataIndex="sapOrderCode" width="150" align="left" text="SAP编号" >
		</column>
		<column dataIndex="billName" width="100" align="center" text="过账状态" >
		</column>
		<column dataIndex="errorMsg" width="300" align="left" text="错误信息"/>
		<column dataIndex="shouDaFang" width="100" align="center" text="客户编号"></column>
		<column dataIndex="regio" width="100" align="left" text="地区">
			<editor xtype="dictcombobox" dict="REGIO" editable="false"/>
		</column>
		<column dataIndex="name1" width="200" align="left" text="客户名称"></column>
		<column dataIndex="orderType" width="100" align="left" text="订单类型">
			<editor xtype="dictcombobox" dict="ORDER_TYPE" editable="false"/>
		</column>
		<column dataIndex="orderDate" xtype="datecolumn" width="100" align="center" text="订单日期" format="Y-m-d">
		</column>
		<column dataIndex="orderTotal" width="80" align="right" text="订单总额"></column>
		<column dataIndex="fuFuanCond" width="80" align="left" text="付款条件">
			<editor xtype="dictcombobox" dict="FU_FUAN_COND" editable="false"/>
		</column>
		<column dataIndex="fuFuanMoney" width="80" align="right" text="付款总额"></column>
		<column dataIndex="handleTime" width="80" align="center" text="处理时效">
			<editor xtype="dictcombobox" dict="HANDLE_TIME" editable="false"/>
		</column>
		<column dataIndex="groupId" width="100" align="left" text="审批用户组">
		</column>
		<column dataIndex="assignee" width="100" align="left" text="审批用户">
		</column>
		<column dataIndex="taskId" width="100" align="left" text="任务编号">
		</column>
		<column dataIndex="claimTime" xtype="datecolumn" width="140" align="center" text="领取时间" format="Y-m-d H:i:s"/>
	</head>
	<sql vname="bpm_task_finance">
	<![CDATA[ select *
  from (select nvl((select cjb.BILL_NAME
                     from sys_job_pool_cjob_v cjb
                    where cjb.zuonr = b.order_code),
                   '未进入过账池') BILL_NAME,
               a.uuid,
               a.group_id,
               a.assignee,
               a.claim_Time,
               c.name1,
               a.task_id,
               c.regio,
               b.*,
               (select desc_zh_cn from sys_data_dict sdd where sdd.key_val = b.urgent_type and sdd.trie_id = 'kh4P5HquGsyUMYuZRnWwZ') as urgent_type_desc,
               (select err.msg from error_order err where err.order_code=b.order_code) as error_msg
          from view_bpm_activity_task a, sale_header b, cust_header c,sys_job_pool_sale_job sjp
         where a.uuid = b.id
           and c.kunnr = b.shou_da_fang
           and a.group_id = 'gp_finance'
           and b.order_code=sjp.zuonr(+)
           and nvl(sjp.job_status,'A') not in ('D','P')) 
 where 1 = 1]]>
  <format name="orderDate" dateFormat="yyyy-MM-dd"/>
	</sql>
</grid>

