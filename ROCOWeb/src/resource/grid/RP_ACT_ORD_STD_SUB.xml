<?xml version="1.0" encoding="UTF-8"?>
<grid>
	<config title="订单进度报表(子进程)" base="/main/sd/pr/" xtype="uxgrid" curd="RE"/>
	<search>
		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="dictcombobox" fieldLabel="分析年份" name="orderYear" dict="PYEAR" value="2016"/>
				<column xtype="dictcombobox" fieldLabel="分析月份" name="orderMonth" dict="PMONTH" value="04"/>
				<column xtype="textfield" fieldLabel="订单号" name="orderCode"/>
			</column>
		</column>
	</search>
	<head>
		<column xtype="rownumberer" width="30" align="right"/>
		<column dataIndex="orderCode" width="140" align="left" text="订单号"/>
		<column dataIndex="posex" width="80" align="left" text="行号"/>
		<column dataIndex="orderYear" width="50" align="left" text="年份"/>
		<column dataIndex="orderMonth" width="40" align="left" text="月份"/>
		<column dataIndex="orderDate" width="100" align="center" text="订单日期"/>
		<column dataIndex="orderStartTime" xtype="datecolumn" width="150" align="center" text="订单开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="orderEndTime" xtype="datecolumn" width="150" align="center" text="订单结束时间" format="Y-m-d H:i:s"/>
		
		<column dataIndex="usertaskDrawingStartTime" xtype="datecolumn" width="150" align="center" text="订单审绘重审开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskDrawingEndTime" xtype="datecolumn" width="150" align="center" text="订单审绘重审结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="drawStartAgn" width="150" align="center" text="订单审绘重审起始操作人"/>
		<column dataIndex="drawEndAgn" width="150" align="center" text="订单审绘重审结束操作人"/>
		
		
		<column dataIndex="drawing2020StartTime" xtype="datecolumn" width="150" align="center" text="2020绘图开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="drawing2020EndTime" xtype="datecolumn" width="150" align="center" text="2020绘图结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="drawing2020StartAgn" width="130" align="center" text="2020绘图起始操作人"/>
		<column dataIndex="drawing2020EndAgn" width="130" align="center" text="2020绘图结束操作人"/>
		
		<column dataIndex="drawingImosStartTime" xtype="datecolumn" width="150" align="center" text="IMOS绘图开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="drawingImosEndTime" xtype="datecolumn" width="150" align="center" text="IMOS绘图结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="drawingImosStartAgn" width="130" align="center" text="IMOS绘图起始操作人"/>
		<column dataIndex="drawingImosEndAgn" width="130" align="center" text="IMOS绘图结束操作人"/>
		
		<column dataIndex="materialAuditStartTime" xtype="datecolumn" width="150" align="center" text="物料审核开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="materialAuditEndTime" xtype="datecolumn" width="150" align="center" text="物料审核结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="materialAuditStartAgn" width="130" align="center" text="物料审核起始操作人"/>
		<column dataIndex="materialAuditEndAgn" width="130" align="center" text="物料审核结束操作人"/>
		
		<column dataIndex="doorMaterialStartTime" xtype="datecolumn" width="150" align="center" text="移门算料开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="doorMaterialEndTime" xtype="datecolumn" width="150" align="center" text="移门算料结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="doorMaterialStartAgn" width="130" align="center" text="移门算料起始操作人"/>
		<column dataIndex="doorMaterialEndAgn" width="130" align="center" text="移门算料结束操作人"/>	
		
		<column dataIndex="holeCheckStartTime" xtype="datecolumn" width="150" align="center" text="孔位审核开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="holeCheckEndTime" xtype="datecolumn" width="150" align="center" text="孔位审核结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="holeCheckStartAgn" width="130" align="center" text="孔位审核起始操作人"/>
		<column dataIndex="holeCheckEndAgn" width="130" align="center" text="孔位审核结束操作人"/>	
			
		<column dataIndex="customerStartTime" xtype="datecolumn" width="150" align="center" text="客户流程开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="customerEndTime" xtype="datecolumn" width="150" align="center" text="客户流程结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="customerStartAgn" width="130" align="center" text="客户流程起始操作人"/>
		<column dataIndex="customerEndAgn" width="130" align="center" text="客户流程结束操作人"/>	
		
		<column dataIndex="bombStartTime" xtype="datecolumn" width="150" align="center" text="炸单(外部)开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="bombEndTime" xtype="datecolumn" width="150" align="center" text="炸单(外部)结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="bombStartAgn" width="140" align="center" text="炸单(外部)起始操作人"/>
		<column dataIndex="bombEndAgn" width="140" align="center" text="炸单(外部)结束操作人"/>
		
		<column dataIndex="endEvent1StartTime" xtype="datecolumn" width="150" align="center" text="结束流程开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="endEvent1EndTime" xtype="datecolumn" width="150" align="center" text="结束流程结束时间" format="Y-m-d H:i:s"/>
	</head>
	<sql vname="RP_ACT_ORD_STD_SUB">
	<![CDATA[ SELECT T.*,
        to_char(T.order_start_time, 'yyyy') AS order_year,
        to_char(T.order_start_time, 'mm') AS order_month
 FROM (
  SELECT tn.order_code,TN.POSEX,tn.order_date,
  MAX(decode(tn.act_id, 'startevent1', tn.start_time)) AS order_start_time,
  MAX(decode(tn.act_id, 'endevent1', tn.end_time)) AS order_end_time,

  MAX(decode(tn.act_id, 'usertask_drawing', tn.start_time)) AS usertask_drawing_start_time,
  MAX(decode(tn.act_id, 'usertask_drawing', tn.end_time)) AS usertask_drawing_end_time,
  MAX(decode(tn.act_id, 'usertask_drawing', tn.start_assignee)) AS draw_start_agn,
  MAX(decode(tn.act_id, 'usertask_drawing', tn.end_assignee)) AS draw_end_agn,

  MAX(decode(tn.act_id, 'usertask1', tn.start_time)) AS drawing_2020_start_time,
  MAX(decode(tn.act_id, 'usertask1', tn.end_time)) AS drawing_2020_end_time,
  MAX(decode(tn.act_id, 'usertask1', tn.start_assignee)) AS drawing_2020_start_agn,
  MAX(decode(tn.act_id, 'usertask1', tn.end_assignee)) AS drawing_2020_end_agn,
  
  MAX(decode(tn.act_id, 'usertask2', tn.start_time)) AS drawing_IMOS_start_time,
  MAX(decode(tn.act_id, 'usertask2', tn.end_time)) AS drawing_IMOS_end_time,
  MAX(decode(tn.act_id, 'usertask2', tn.start_assignee)) AS drawing_IMOS_start_agn,
  MAX(decode(tn.act_id, 'usertask2', tn.end_assignee)) AS drawing_IMOS_end_agn,
  
  MAX(decode(tn.act_id, 'usertask3', tn.start_time)) AS material_audit_start_time,
  MAX(decode(tn.act_id, 'usertask3', tn.end_time)) AS material_audit_end_time,
  MAX(decode(tn.act_id, 'usertask3', tn.start_assignee)) AS material_audit_start_agn,
  MAX(decode(tn.act_id, 'usertask3', tn.end_assignee)) AS material_audit_end_agn,
  
  MAX(decode(tn.act_id, 'usertask4', tn.start_time)) AS door_material_start_time,
  MAX(decode(tn.act_id, 'usertask4', tn.end_time)) AS door_material_end_time,
  MAX(decode(tn.act_id, 'usertask4', tn.start_assignee)) AS door_material_start_agn,
  MAX(decode(tn.act_id, 'usertask4', tn.end_assignee)) AS door_material_end_agn,
  
  MAX(decode(tn.act_id, 'usertask5', tn.start_time)) AS hole_check_start_time,
  MAX(decode(tn.act_id, 'usertask5', tn.end_time)) AS hole_check_end_time,
  MAX(decode(tn.act_id, 'usertask5', tn.start_assignee)) AS hole_check_start_agn,
  MAX(decode(tn.act_id, 'usertask5', tn.end_assignee)) AS hole_check_end_agn,
  
  MAX(decode(tn.act_id, 'usertask6', tn.start_time)) AS customer_start_time,
  MAX(decode(tn.act_id, 'usertask6', tn.end_time)) AS customer_end_time,
  MAX(decode(tn.act_id, 'usertask6', tn.start_assignee)) AS customer_start_agn,
  MAX(decode(tn.act_id, 'usertask6', tn.end_assignee)) AS customer_end_agn,

  MAX(decode(tn.act_id, 'receivetask1', tn.start_time)) AS bomb_start_time,
  MAX(decode(tn.act_id, 'receivetask1', tn.end_time)) AS bomb_end_time,
  MAX(decode(tn.act_id, 'receivetask1', tn.start_assignee)) AS bomb_start_agn,
  MAX(decode(tn.act_id, 'receivetask1', tn.end_assignee)) AS bomb_end_agn,

  MAX(decode(tn.act_id, 'endevent1', tn.start_time)) AS end_event1_start_time,
  MAX(decode(tn.act_id, 'endevent1', tn.end_time)) AS end_event1_end_time,
  MAX(decode(tn.act_id, 'endevent1', tn.start_assignee)) AS endevt_start_agn,
  MAX(decode(tn.act_id, 'endevent1', tn.end_assignee)) AS endevt_end_agn,
  MAX(TN.JIAO_QI_TIAN_SHU) AS JIAO_QI_TIAN_SHU
FROM ORD_RP_VIEW_SUB tn
 GROUP BY TN.order_code,tN.POSEX,tn.ORDER_DATE) T ]]>
 		<format name="orderDate" dateFormat="yyyy-MM-dd"/>
	</sql>
</grid>