<?xml version="1.0" encoding="UTF-8"?>
<grid>
	<config title="订单进度报表(免费)" base="/main/sd/pr/" xtype="uxgrid" curd="RE"/>
	<search>
		<column layout="hbox" xtype="fieldcontainer">
			<column xtype="container" flex="1" layout="hbox">
				<column xtype="dictcombobox" fieldLabel="分析年份" name="orderYear" dict="PYEAR" value="2016"/>
				<column xtype="dictcombobox" fieldLabel="分析月份" name="orderMonth" dict="PMONTH" value="04"/>
				<column xtype="textfield" fieldLabel="订单号" name="orderCode"/>
			</column>
		</column>
	</search>
	<head>
		<column xtype="rownumberer" width="30" align="right"/>
		<column dataIndex="orderCode" width="140" align="left" text="订单号"/>
		<column dataIndex="orderYear" width="50" align="left" text="年份"/>
		<column dataIndex="orderMonth" width="40" align="left" text="月份"/>
		<column dataIndex="orderDate" width="100" align="center" text="订单日期"/>
		<column dataIndex="orderStartTime" xtype="datecolumn" width="150" align="center" text="订单开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="orderEndTime" xtype="datecolumn" width="150" align="center" text="订单结束时间" format="Y-m-d H:i:s"/>
		
		<column dataIndex="usertaskStoreStartTime" xtype="datecolumn" width="150" align="center" text="起草开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskStoreEndTime" xtype="datecolumn" width="150" align="center" text="起草结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="storeStartAgn" width="120" align="center" text="起草起始操作人"/>
		<column dataIndex="storeEndAgn" width="120" align="center" text="起草结束操作人"/>
		
		
		<column dataIndex="usertaskValuationStartTime" xtype="datecolumn" width="150" align="center" text="价格审核开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskValuationEndTime" xtype="datecolumn" width="150" align="center" text="价格审核结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="valuationStartAgn" width="130" align="center" text="价格审核起始操作人"/>
		<column dataIndex="valuationEndAgn" width="130" align="center" text="价格审核结束操作人"/>
		
		<column dataIndex="usertaskConfirmStartTime" xtype="datecolumn" width="150" align="center" text="确认报价开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskConfirmEndTime" xtype="datecolumn" width="150" align="center" text="确认报价结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="confirmStartAgn" width="130" align="center" text="确认报价起始操作人"/>
		<column dataIndex="confirmEndAgn" width="130" align="center" text="确认报价结束操作人"/>
		
		<column dataIndex="usertaskFinanceStartTime" xtype="datecolumn" width="150" align="center" text="财务确认开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="usertaskFinanceEndTime" xtype="datecolumn" width="150" align="center" text="财务确认结束时间" format="Y-m-d H:i:s"/>
		<column dataIndex="financeStartAgn" width="130" align="center" text="财务确认起始操作人"/>
		<column dataIndex="financeEndAgn" width="130" align="center" text="财务确认结束操作人"/>
		
		<column dataIndex="endEvent1StartTime" xtype="datecolumn" width="150" align="center" text="结束流程开始时间" format="Y-m-d H:i:s"/>
		<column dataIndex="endEvent1EndTime" xtype="datecolumn" width="150" align="center" text="结束流程结束时间" format="Y-m-d H:i:s"/>				 
	</head>
	<sql vname="RP_ACT_ORD_FRE">
	<![CDATA[SELECT T.*,
        to_char(T.order_start_time, 'yyyy') AS order_year,
        to_char(T.order_start_time, 'mm') AS order_month
 FROM (
  SELECT tn.order_code,tn.order_date,
  MAX(decode(tn.act_id, 'startevent1', tn.start_time)) AS order_start_time,
  MAX(decode(tn.act_id, 'endevent1', tn.end_time)) AS order_end_time,

  MAX(decode(tn.act_id, 'usertask1', tn.start_time)) AS usertask_store_start_time,
  MAX(decode(tn.act_id, 'usertask1', tn.end_time)) AS usertask_store_end_time,
  MAX(decode(tn.act_id, 'usertask1', tn.start_assignee)) AS store_start_agn,
  MAX(decode(tn.act_id, 'usertask1', tn.end_assignee)) AS store_end_agn,

  MAX(decode(tn.act_id, 'usertask2', tn.start_time)) AS usertask_valuation_start_time,
  MAX(decode(tn.act_id, 'usertask2', tn.end_time)) AS usertask_valuation_end_time,
  MAX(decode(tn.act_id, 'usertask2', tn.start_assignee)) AS valuation_start_agn,
  MAX(decode(tn.act_id, 'usertask2', tn.end_assignee)) AS valuation_end_agn,

  MAX(decode(tn.act_id, 'usertask3', tn.start_time)) AS usertask_confirm_start_time,
  MAX(decode(tn.act_id, 'usertask3', tn.end_time)) AS usertask_confirm_end_time,
  MAX(decode(tn.act_id, 'usertask3', tn.start_assignee)) AS confirm_start_agn,
  MAX(decode(tn.act_id, 'usertask3', tn.end_assignee)) AS confirm_end_agn,

  MAX(decode(tn.act_id, 'usertask4', tn.start_time)) AS usertask_finance_start_time,
  MAX(decode(tn.act_id, 'usertask4', tn.end_time)) AS usertask_finance_end_time,
  MAX(decode(tn.act_id, 'usertask4', tn.start_assignee)) AS finance_start_agn,
  MAX(decode(tn.act_id, 'usertask4', tn.end_assignee)) AS finance_end_agn,

  MAX(decode(tn.act_id, 'endevent1', tn.start_time)) AS end_event1_start_time,
  MAX(decode(tn.act_id, 'endevent1', tn.end_time)) AS end_event1_end_time,
  MAX(decode(tn.act_id, 'endevent1', tn.start_assignee)) AS endevt_start_agn,
  MAX(decode(tn.act_id, 'endevent1', tn.end_assignee)) AS endevt_end_agn,
  MAX(TN.JIAO_QI_TIAN_SHU) AS JIAO_QI_TIAN_SHU
FROM ORD_RP_VIEW_FREE tn
 GROUP BY tN.order_code,tn.ORDER_DATE) T]]>
 		<format name="orderDate" dateFormat="yyyy-MM-dd"/>
	</sql>
</grid>